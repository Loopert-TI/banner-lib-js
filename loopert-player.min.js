function loadScript(e,t={}){return new Promise(((r,i)=>{if(document.querySelector(`script[src="${e}"]`))return void r();const o=document.createElement("script");o.src=e,Object.keys(t).forEach((e=>{o.setAttribute(e,t[e])})),o.onload=()=>r(),o.onerror=()=>i(new Error(`Falha ao carregar ${e}`)),document.head.appendChild(o)}))}function extractDataAttributes(e){const t={};return Object.entries(e.dataset).forEach((([e,r])=>{const i=`data-${e.replace(/([A-Z])/g,"-$1").toLowerCase()}`;t[i]=r})),t}function findLoopertScripts(){return Array.from(document.querySelectorAll('script[src*="loopert-player"]'))}class LoopertPlayer{constructor(e={}){this.options={id:"player",streamUrl:"",backgroundImage:"",backgroundColor:"#2E5EAA",borderColor:"#2E5EAA",...e},this.player=null,this.init()}createPlayerDiv(){let e=document.getElementById(this.options.id);e||(e=document.createElement("div"),e.id=this.options.id,document.body.appendChild(e))}async init(){try{this.createPlayerDiv(),await this.loadDependencies(),this.initPlayer()}catch(e){console.error("Erro ao inicializar LoopertPlayer:",e)}}async loadDependencies(){const e=[];if(window.Playerjs||e.push(loadScript("player.min.js")),!window.BannerLib){const t=findLoopertScripts();if(0===t.length)return;const r=extractDataAttributes(t[0]);e.push(loadScript("banner-lib.js",r))}await Promise.all(e)}initPlayer(){if(!window.Playerjs)throw new Error("Playerjs não está disponível");window.PlayerjsEvents=(e,t,r)=>{this.handlePlayerEvents(e,t,r)},this.player=new window.Playerjs({id:this.options.id,file:this.options.streamUrl,poster:this.options.backgroundImage,...this.getPlayerJsOptions()});const e=document.getElementById("player");document.getElementById("oframeplayer").style.backgroundColor=this.options.backgroundColor,e.style.borderColor=this.options.borderColor}getPlayerJsOptions(){const e={...this.options};return delete e.streamUrl,e}handlePlayerEvents(e,t,r){switch(e){case"play":this.onPlay(t,r);break;case"pause":this.onPause(t,r);break;case"ended":this.onEnded(t,r);break;default:this.onGenericEvent(e,t,r)}this.options.onEvent&&"function"==typeof this.options.onEvent&&this.options.onEvent(e,t,r)}onPlay(e,t){this.initBanner()}onPause(e,t){}onEnded(e,t){}onGenericEvent(e,t,r){}initBanner(){if(window.BannerLib)try{window.BannerLib.init()}catch(e){console.error("Erro ao inicializar banner:",e)}}play(){this.player&&this.player.api&&this.player.api("play")}pause(){this.player&&this.player.api&&this.player.api("pause")}stop(){this.player&&this.player.api&&this.player.api("stop")}setVolume(e){this.player&&this.player.api&&this.player.api("volume",e)}setFile(e){this.player&&this.player.api&&this.player.api("file",e)}destroy(){this.player&&this.player.api&&this.player.api("destroy"),this.player=null}getPlayer(){return this.player}}